The join function is called every time a dwarf leaves the cave.
The dwarf could check how much dwarfs are in the row and the color of each hat in the row.

The function must return the index as a number at which the dwarf should join the row.